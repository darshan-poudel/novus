"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.addMavenPublishPlugin = void 0;
const devkit_1 = require("@nx/devkit");
const common_jvm_1 = require("@nxrocks/common-jvm");
function addMavenPublishPlugin(tree, options) {
    if (options.buildSystem === 'gradle-project' ||
        options.buildSystem === 'gradle-project-kotlin') {
        devkit_1.logger.debug(`Adding 'maven-publish' plugin...`);
        (0, common_jvm_1.addGradlePlugin)(tree, options.projectRoot, options.language, 'maven-publish', undefined, options.buildSystem === 'gradle-project-kotlin');
        const artifactSource = options.projectType === 'application' ? 'bootJar' : 'jar';
        const publishing = options.buildSystem === 'gradle-project-kotlin'
            ? (0, common_jvm_1.stripIndent) `
        publishing {
        	publications {
        		create<MavenPublication>("mavenJava") {
        			artifact(tasks.getByName("${artifactSource}"))
        		}
        	}
        }
        `
            : (0, common_jvm_1.stripIndent) `
        publishing {
        	publications {
        		mavenJava(MavenPublication) {
        			artifact ${artifactSource}
        		}
        	}
        }
        `;
        const ext = options.buildSystem === 'gradle-project-kotlin' ? '.kts' : '';
        const buildGradlePath = `${options.projectRoot}/build.gradle${ext}`;
        const content = tree.read(buildGradlePath, 'utf-8') + '\n' + publishing;
        tree.write(buildGradlePath, content);
    }
}
exports.addMavenPublishPlugin = addMavenPublishPlugin;
//# sourceMappingURL=add-maven-publish-plugin.js.map