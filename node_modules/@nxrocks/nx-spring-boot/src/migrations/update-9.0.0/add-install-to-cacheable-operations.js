"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const devkit_1 = require("@nx/devkit");
function update(host) {
    var _a, _b, _c, _d, _e, _f;
    var _g, _h;
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const nxJson = (0, devkit_1.readJson)(host, 'nx.json');
        let cacheableOperationsPreNx17 = (_c = (_b = (_a = nxJson.tasksRunnerOptions) === null || _a === void 0 ? void 0 : _a['default']) === null || _b === void 0 ? void 0 : _b.options) === null || _c === void 0 ? void 0 : _c.cacheableOperations;
        if ((cacheableOperationsPreNx17 === null || cacheableOperationsPreNx17 === void 0 ? void 0 : cacheableOperationsPreNx17.includes['install']) === false) {
            cacheableOperationsPreNx17 = [...cacheableOperationsPreNx17, 'install'];
            (0, devkit_1.writeJson)(host, 'nx.json', nxJson);
        }
        else {
            (_d = nxJson.targetDefaults) !== null && _d !== void 0 ? _d : (nxJson.targetDefaults = {});
            (_e = (_g = nxJson.targetDefaults)['install']) !== null && _e !== void 0 ? _e : (_g['install'] = {});
            (_f = (_h = nxJson.targetDefaults['install']).cache) !== null && _f !== void 0 ? _f : (_h.cache = true);
            (0, devkit_1.writeJson)(host, 'nx.json', nxJson);
        }
        yield (0, devkit_1.formatFiles)(host);
    });
}
exports.default = update;
//# sourceMappingURL=add-install-to-cacheable-operations.js.map