"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.addPluginToNxJson = void 0;
const devkit_1 = require("@nx/devkit");
function addPluginToNxJson(pluginName, tree, options, ...cacheableOperations) {
    var _a, _b, _c, _d;
    var _e, _f;
    //
    const nxJson = (0, devkit_1.readNxJson)(tree);
    if (!nxJson) {
        throw new Error(`${pluginName} requires nx.json to be present in the workspace`);
    }
    (_a = nxJson.plugins) !== null && _a !== void 0 ? _a : (nxJson.plugins = []);
    if (!nxJson.plugins.some((p) => typeof p === 'string' ? p === pluginName : p.plugin === pluginName)) {
        nxJson.plugins.push(Object.assign({ plugin: pluginName }, (options ? { options } : {})));
    }
    (_b = nxJson.targetDefaults) !== null && _b !== void 0 ? _b : (nxJson.targetDefaults = {});
    for (const target of cacheableOperations) {
        (_c = (_e = nxJson.targetDefaults)[target]) !== null && _c !== void 0 ? _c : (_e[target] = {});
        (_d = (_f = nxJson.targetDefaults[target]).cache) !== null && _d !== void 0 ? _d : (_f.cache = true);
    }
    (0, devkit_1.updateNxJson)(tree, nxJson);
}
exports.addPluginToNxJson = addPluginToNxJson;
//# sourceMappingURL=add-plugin-to-nx-json.js.map